-- +goose Up
-- +goose StatementBegin
CREATE TABLE companies (
  id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  name VARCHAR(255) NOT NULL,
  address VARCHAR(255),
  contact_number VARCHAR(25),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE users (
  id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  email VARCHAR(255) UNIQUE,
  password VARCHAR(255) NOT NULL,
  name VARCHAR(255) NOT NULL,
  company_id BIGINT NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (company_id) REFERENCES companies (id) ON DELETE CASCADE
);

CREATE TABLE roles (
  id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  name VARCHAR(50) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE users_roles (
  role_id BIGINT REFERENCES roles (id),
  user_id BIGINT REFERENCES users (id),
  PRIMARY KEY (role_id, user_id)
);

CREATE TABLE auto_categories (
  id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  name VARCHAR(100) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE companies_auto_categories (
  auto_category_id BIGINT REFERENCES auto_categories (id),
  company_id BIGINT REFERENCES companies (id),
  PRIMARY KEY (auto_category_id, company_id)
);

CREATE TABLE biddings (
  id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  company_id BIGINT NOT NULL,
  title VARCHAR(200) NOT NULL,
  description TEXT,
  start_date TIMESTAMP,
  end_date TIMESTAMP,
  category_id BIGINT NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (company_id) REFERENCES companies (id) ON DELETE CASCADE,
  FOREIGN KEY (category_id) REFERENCES auto_categories (id) ON DELETE NO ACTION
);

CREATE TABLE auto_offers (
  id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  bidding_id BIGINT NOT NULL,
  offer_details TEXT,
  offer_date TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (bidding_id) REFERENCES biddings (id) ON DELETE CASCADE
);

-- +goose StatementEnd
-- +goose Down
-- +goose StatementBegin
DROP TABLE auto_offers;

DROP TABLE biddings;

DROP TABLE users_roles;

DROP TABLE roles;

DROP TABLE users;

DROP TABLE companies_auto_categories;

DROP TABLE companies;

DROP TABLE auto_categories;

-- +goose StatementEnd
